{
  "hash": "aef8c63387f7719c9e6e123381045325",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Day 25 of the #30DayMapChallenge - Climate\"\nauthor: \n  - name: Javier Elío\n    url: https://github.com/javiereliomedina\n    orcid: 0000-0003-0624-2345\n    affiliation: Western Norway University of Applied Sciences\n    affiliation-url: https://www.hvl.no/en/employee/?user=Javier.Elio \ndate: 11-25-2019\ncategories: [R, Data visualization, 30DayChallenge]\nimage: featured.jpg\ndraft: false setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n\n\n\nPackages we are going to use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  library(raster)\n  library(animation)\n  library(ncdf4)\n  library(sf)\n  library(ggplot2)\n  library(rworldmap)\n  library(rworldxtra)\n```\n:::\n\n\nFirstly, I have downloaded the monthly average temperatures from [ECMWF](https://cds.climate.copernicus.eu/cdsapp#!/home). You may need to register for the Climate Data Store - CDS, but it is free and there are plenty of interesting datasets!. I have download the [*Climate data for the European energy sector from 1979 to 2016 derived from ERA-Interim*](https://cds.climate.copernicus.eu/cdsapp#!/dataset/sis-european-energy-sector?tab=overview):\n\n-   Variable: Air temperature\n-   Time aggregation: month average\n-   Vertical level: 2 m\n-   Bias correction: Normal distribution adjustment\n-   Format: Zip file\n\nThen, we need to load the data into R. I have created a vector (*years*) with dates from Feb. 1979 to Dec. 2016, we will use it for adding the date (year, month) to the rasters of temperature distribution (resolution 0.5° x 0.5°).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Vector with years and months\n  years <- seq(as.Date(\"1979/01/01\"), as.Date(\"2016/12/01\"), by = \"month\")\n  years <- format(years, \"%Y-%m\")\n  \n# Load the temperatures as a list with raster layers \n  temp_m <- list()\n  for (i in seq_along(years)) {\n    temp_m[i] <- raster(\"H_ERAI_ECMW_T159_TA-_0002m_Euro_22W27N_45E72N_050d_IN_TIM_19790101_20161231_01m_NA-_nbc_org_NA_NA-.nc\", i)\n  }\n  temp_m <- brick(temp_m)\n\n# Convert to a data frame with rasters\n  raster_df <- as.data.frame(temp_m, xy = TRUE)\n```\n:::\n\n\nWe also need to load the world map for plotting the temperatures, in this case I have used the R package *rworldmap*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld <- rworldmap::getMap(resolution = \"high\") %>% \n  st_as_sf() # Convert to an sf object\n```\n:::\n\n\nFinally, I have created an auxiliary function (*steps(i)*) for plotting the monthly average temperatures. We will use it for plotting the temperatures by month (i.e. Jan. 2016) and for making animations (i.e. monthly average temperatures in 2016). The function (*steps(i)*) will plot the temperature in the month *i = 1, 2, ..., 456*, where 1 = 1979-01; 2 = 1979-02, ..., and 456 = 2016-12.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsteps <- function(i) {\n    p <- ggplot() +\n      geom_sf(data = world, fill = \"grey\") +\n      geom_raster(data = raster_df,\n                  aes(x = x, y = y, fill = raster_df[[i+2]])) +\n      scale_fill_gradient(\"Temp [C]\",\n                          low = 'yellow', high = 'red',\n                          na.value = NA,\n                          limits = c(-35, 35)) +\n      coord_sf(xlim = c(-10, 45), ylim = c(30, 71)) +\n      labs(title = \"Climate data for the European energy sector\",\n           subtitle = paste(\"Year:\", years[i]),\n           caption = \"Source: European Centre for Medium-Range Weather Forecasts (ECMWF)\")\n    print(p) \n  }\n```\n:::\n\n\nAverage temperatures in Jan. 2016.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsteps(445)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nFor the animation I loop the function *steps* from 445 (Jan. 2016) to 456 (Dic. 2016), and save the result as *.gif*:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanimation::saveGIF(for(i in 445:456) steps(i), \n                     interval = 0.2,\n                     movie.name = \"Day25_Temp_AV_month_2m_2016.gif\")\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](Day25_Temp_AV_month_2m_2016.gif){fig-align='center' width=70%}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}